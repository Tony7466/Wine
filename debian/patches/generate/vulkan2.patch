X-Git-Url: https://source.winehq.org/git/wine.git/blobdiff_plain/d5b31ea663c3dcbc75df8c0827fb21b56b41b635..3d824d11dbde45299963a758b97d1e417dca36e0:/dlls/winevulkan/make_vulkan

--- a/dlls/winevulkan/make_vulkan
+++ b/dlls/winevulkan/make_vulkan
@@ -2043,6 +2043,8 @@ class VkStruct(Sequence):
         """
 
         for m in self.members:
+            if self.name == m.type:
+                continue
             if m.needs_alignment():
                 return True
         return False
@@ -2057,6 +2059,8 @@ class VkStruct(Sequence):
             return True
 
         for m in self.members:
+            if self.name == m.type:
+                continue
             if m.needs_conversion():
                 return True
         return False
@@ -2065,6 +2069,8 @@ class VkStruct(Sequence):
         """ Returns if struct members need unwrapping of handle. """
 
         for m in self.members:
+            if self.name == m.type:
+                continue
             if m.needs_unwrapping():
                 return True
         return False
@@ -2073,11 +2079,11 @@ class VkStruct(Sequence):
         """ Check if any struct member needs some memory freeing."""
 
         for m in self.members:
+            if self.name == m.type:
+                continue
             if m.needs_free():
                 return True
 
-            continue
-
         return False
 
     def needs_struct_extensions_conversion(self):
@@ -3353,7 +3359,7 @@ class VkRegistry(object):
                 if "data" in type_info:
                     types[m.type]["data"].required = True
 
-                if type_info["category"] == "struct":
+                if type_info["category"] == "struct" and struct.name != m.type:
                     # Yay, recurse
                     mark_struct_dependencies(type_info["data"], types)
                 elif type_info["category"] == "funcpointer":
