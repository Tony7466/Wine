description: do not use pointers after calling realloc (gcc 12 -Wuse-after-free)
author: Michael Gilbert <mgilbert@debian.org>

--- a/server/queue.c
+++ b/server/queue.c
@@ -3372,13 +3372,15 @@ DECL_HANDLER(get_rawinput_buffer)
         if (cur + data->size > buf + get_reply_max_size()) break;
         if (cur + data->size > buf + buf_size)
         {
+            ptrdiff_t diff = cur - buf;
+
             buf_size += buf_size / 2 + extra_size;
             if (!(tmp = realloc( buf, buf_size )))
             {
                 set_error( STATUS_NO_MEMORY );
                 return;
             }
-            cur = tmp + (cur - buf);
+            cur = tmp + diff;
             buf = tmp;
         }
 
--- a/dlls/winex11.drv/clipboard.c
+++ b/dlls/winex11.drv/clipboard.c
@@ -1853,6 +1853,7 @@ static BOOL X11DRV_CLIPBOARD_GetProperty
 
     for (;;)
     {
+        unsigned char *tmp = val;
         if (XGetWindowProperty(display, w, prop, pos, INT_MAX / 4, False,
                                AnyPropertyType, atype, &aformat, &nitems, &remain, &buffer))
         {
@@ -1862,7 +1863,7 @@ static BOOL X11DRV_CLIPBOARD_GetProperty
         }
 
         count = get_property_size( aformat, nitems );
-        *data = realloc( val, pos * sizeof(int) + count + 1 );
+        *data = realloc( tmp, pos * sizeof(int) + count + 1 );
 
         if (!*data)
         {
