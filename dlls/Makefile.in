TOPSRCDIR = @top_srcdir@
TOPOBJDIR = ..
SRCDIR    = @srcdir@
VPATH     = @srcdir@

INSTALLDIRS = $(DESTDIR)$(dlldir)

DLLSUBDIRS     = @ALL_DLL_DIRS@
IMPLIBSUBDIRS  = @ALL_IMPLIB_DIRS@
TESTSUBDIRS    = @ALL_TEST_DIRS@
SUBDIRS        = $(DLLSUBDIRS) $(IMPLIBSUBDIRS) $(TESTSUBDIRS)
BUILDSUBDIRS   = $(DLLSUBDIRS) $(TESTSUBDIRS)
INSTALLSUBDIRS = $(DLLSUBDIRS) $(IMPLIBSUBDIRS)
DOCSUBDIRS     = $(DLLSUBDIRS)

@MAKE_RULES@

# Main target

all: $(BUILDSUBDIRS)

# Import libraries

STATIC_LIBS = @ALL_STATIC_LIBS@
IMPORT_LIBS = @ALL_IMPORT_LIBS@

$(TESTSUBDIRS:%=%/__crosstest__): $(STATIC_LIBS:.a=.cross.a) $(IMPORT_LIBS:.def=.cross.a)

implib: $(STATIC_LIBS) $(IMPORT_LIBS)

testsubdirs: $(TESTSUBDIRS)

.PHONY: implib testsubdirs

$(BUILDSUBDIRS): $(STATIC_LIBS) $(IMPORT_LIBS)
$(INSTALLSUBDIRS:%=%/__install__) $(INSTALLSUBDIRS:%=%/__install-lib__): $(STATIC_LIBS) $(IMPORT_LIBS)

@ALL_IMPORTLIB_RULES@

# Misc rules

uninstall::
	-rmdir $(DESTDIR)$(fakedlldir) $(DESTDIR)$(dlldir)
